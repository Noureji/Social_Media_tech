{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Boards{% endblock %}

{% block container_titre %}
<i class="bi bi-collection-fill me-2"></i> Boards
{% endblock %}

{% block container %}

<!-- STAFF ACTION BAR -->
{% if user.is_authenticated and user.is_staff %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div class="d-flex align-items-center">
    <!-- ICON ADMIN -->
    <i class="bi bi-shield-lock-fill text-primary fs-3 me-2"></i>
    <div>
      <h6 class="text-muted mb-0">Administration</h6>
      <h4 class="fw-bold mb-0">Gestion des Boards</h4>
    </div>
  </div>

  <a href="{% url 'board_create' %}" class="btn btn-primary shadow-sm">
    <i class="bi bi-plus-circle me-1"></i> Nouveau Board
  </a>
</div>
{% endif %}

<!-- BOARDS GRID -->
<div class="row g-4">

  {% for borde in bordes %}
  <div class="col-md-6 col-lg-4">
    <div class="card h-100 border-0 shadow-sm hover-card">

      <!-- CARD BODY -->
      <div class="card-body">

        <div class="d-flex justify-content-between align-items-start mb-3">

          <div class="d-flex align-items-center">
            <div class="icon-box bg-primary text-white me-3 rounded-circle d-flex justify-content-center align-items-center" style="width:40px; height:40px;">
              <i class="bi bi-kanban fs-5"></i>
            </div>

            <div>
              <h5 class="fw-bold mb-0">
                <a href="{% url 'show' borde.id %}" class="text-dark text-decoration-none">
                  {{ borde.name }}
                </a>
              </h5>
              <small class="text-muted">Board de discussion</small>
            </div>
          </div>

          <!-- STAFF ACTIONS -->
          {% if user.is_authenticated and user.is_staff %}
          <div class="dropdown">
            <button class="btn btn-sm btn-light" data-bs-toggle="dropdown">
              <i class="bi bi-three-dots-vertical"></i>
            </button>

            <ul class="dropdown-menu dropdown-menu-end">
              <li>
                <a class="dropdown-item" href="{% url 'board_update' borde.id %}">
                  <i class="bi bi-pencil-square me-1"></i> Modifier
                </a>
              </li>
              <li>
                <a class="dropdown-item text-danger" href="{% url 'board_delete' borde.id %}">
                  <i class="bi bi-trash me-1"></i> Supprimer
                </a>
              </li>
            </ul>
          </div>
          {% endif %}
        </div>

        <p class="text-muted small mb-0">
          {{ borde.description|truncatewords:20 }}
        </p>

      </div>

      <!-- CARD FOOTER -->
      <div class="card-footer bg-transparent border-0 pt-0">
        <a href="{% url 'show' borde.id %}" class="btn btn-outline-primary w-100">
          <i class="bi bi-eye me-1"></i> Voir les topics
        </a>
      </div>

    </div>
  </div>

  {% empty %}
  <!-- EMPTY STATE -->
  <div class="col-12">
    <div class="card border-0 shadow-sm text-center p-5">
      <i class="bi bi-kanban fs-1 text-secondary mb-3"></i>
      <h5 class="fw-bold">Aucun board disponible</h5>
      <p class="text-muted mb-4">
        Aucun board n’a encore été créé.
      </p>

      {% if user.is_authenticated and user.is_staff %}
      <a href="{% url 'board_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle me-1"></i> Créer le premier board
      </a>
      {% endif %}
    </div>
  </div>
  {% endfor %}

</div>

{% endblock %}
