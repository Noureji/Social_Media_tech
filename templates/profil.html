{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% block title %}My Profile{% endblock %}
{% block container_titre %}My Profile{% endblock %}

{% block container %}
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-6">

      <!-- Carte Profil -->
      <div class="card shadow-sm border-0">
        <div class="card-body position-relative">

          <!-- USER INFO -->
          <div class="text-center mb-4">
            <img id="avatarPreview"
                 {% if user.profile.avatar %}
                   src="{{ user.profile.avatar.url }}"
                 {% else %}
                   src="{% static 'image/imageuser.png'%}"
                 {% endif %}
                 class="rounded-circle border border-2"
                 width="100" height="100">
            <h4 class="mt-2">{{ user.username }}</h4>
            <p class="text-muted mb-0">{{ user.email }}</p>
          </div>

          <!-- Dates -->
          <div class="d-flex justify-content-between text-muted small mb-4">
            <p class="mb-0">
              <i class="bi bi-calendar-check me-1"></i>
              <strong>Date joined:</strong> {{ user.date_joined|date:"d/m/Y" }}
            </p>
            <p class="mb-0">
              <i class="bi bi-clock-history me-1"></i>
              <strong>Last login:</strong> {{ user.last_login|naturaltime }}
            </p>
          </div>

          <hr>

          <!-- FORM -->
          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- Avatar upload -->
            <div class="mb-3">
              <label class="form-label fw-semibold"><i class="bi bi-image me-1"></i> Avatar</label>
              <input type="file" name="avatar" class="form-control"
                     accept="image/*" onchange="previewAvatar(this)">
            </div>

            <div class="mb-3">
              <label class="form-label fw-semibold"><i class="bi bi-person-fill me-1"></i> First name</label>
              <input type="text" name="first_name" class="form-control"
                     value="{{ user.first_name }}">
            </div>

            <div class="mb-3">
              <label class="form-label fw-semibold"><i class="bi bi-person-fill me-1"></i> Last name</label>
              <input type="text" name="last_name" class="form-control"
                     value="{{ user.last_name }}">
            </div>

            <div class="mb-3">
              <label class="form-label fw-semibold"><i class="bi bi-envelope-fill me-1"></i> Email</label>
              <input type="email" name="email" class="form-control"
                     value="{{ user.email }}">
            </div>

            <button type="submit" class="btn btn-success w-100">
              <i class="bi bi-save me-1"></i> Update profile
            </button>
          </form>

        </div>
      </div>

    </div>
  </div>
</div>

<!-- Toast pour succÃ¨s -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
  {% for message in messages %}
    <div class="toast align-items-center text-bg-success border-0 show" role="alert">
      <div class="d-flex">
        <div class="toast-body">
          {{ message }}
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  {% endfor %}
</div>

<!-- JS -->
<script>
  function previewAvatar(input) {
    const preview = document.getElementById("avatarPreview");
    const file = input.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = e => preview.src = e.target.result;
      reader.readAsDataURL(file);
    }
  }
</script>
{% endblock %}
